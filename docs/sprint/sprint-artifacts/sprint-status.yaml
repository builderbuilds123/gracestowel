# Sprint Status Tracking
# Generated by Sprint Planning Workflow
# Date: 2025-12-08T21:30:00-08:00

generated: "2025-12-08T21:30:00-08:00"
project: gracestowel
project_key: GRACE
tracking_system: file-system
story_location: docs/sprint/sprint-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Epic tech context created (required before drafting stories)
#   - in-progress: Active development
#   - done: Epic completed
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder
#   - ready-for-dev: Draft approved and story context created
#   - in-progress: Developer actively working on implementation
#   - review: Under SM review
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done

development_status:
  # --- Core Epics (from docs/product/epics/overview.md) ---
  epic-0: backlog
  0-1-establish-medusa-client-hyperdrive-connection: done
  0-2-refactor-pdp-to-dynamic-data: done
  epic-0-retrospective: optional

  epic-1: in-progress
  1-1-initialize-posthog-sdk-client-side: done
  1-2-track-key-user-events:
    path: docs/sprint/sprint-artifacts/1-2-track-key-user-events.md
    status: done
  1-3-associate-events-anonymous-id: done
  epic-1-retrospective: optional

  epic-2: backlog
  2-1-implement-server-side-tracking:
    path: docs/sprint/sprint-artifacts/2-1-implement-server-side-tracking.md
    status: done
  2-2-identify-associate-logged-in-users:
    path: docs/sprint/sprint-artifacts/2-2-identify-associate-logged-in-users.md
    status: done
  2-3-ensure-correct-user-id-server-side:
    status: done
    meta: "Pre-existing implementation verified. Server-side events use customer_id or guest_${order.id}."
  epic-2-retrospective: optional

  epic-3: backlog
  3-1-create-posthog-dashboards: backlog
  3-2-enable-advanced-filtering: backlog
  3-3-provide-access-dashboards-admin: backlog
  epic-3-retrospective: optional

  epic-4: backlog
  4-1-implement-error-tracking-posthog:
    path: docs/sprint/sprint-artifacts/4-1-implement-error-tracking-posthog.md
    status: done
  4-2-track-web-vitals-performance:
    path: docs/sprint/sprint-artifacts/4-2-track-web-vitals-performance.md
    status: done
  4-3-monitor-api-latency-error-rates:
    path: docs/sprint/sprint-artifacts/4-3-monitor-api-latency-error-rates.md
    status: done
  4-4-backend-error-tracking:
    path: docs/sprint/sprint-artifacts/4-4-backend-error-tracking.md
    status: done
  4-5-health-check-monitoring:
    path: docs/sprint/sprint-artifacts/4-5-health-check-monitoring.md
    status: done
  4-6-create-posthog-monitoring-dashboards: backlog
  epic-4-retrospective: optional

  # --- Enhanced Analytics (Growth Features from PRD) ---
  epic-5-enhanced-analytics: in-progress
  5-2-comprehensive-frontend-tracking:
    path: docs/sprint/sprint-artifacts/5-2-comprehensive-frontend-tracking.md
    status: done
    meta: "PRD Growth Features: Track users' every move. API calls, navigation, scroll, engagement, forms."
    completed: "2025-12-14"
  5-2-1-monitored-fetch-api-events:
    path: docs/sprint/sprint-artifacts/5-2-1-monitored-fetch-api-events.md
    status: done
    completed: "2025-12-14"
  5-2-2-navigation-tracking:
    path: docs/sprint/sprint-artifacts/5-2-2-navigation-tracking.md
    status: todo
  5-2-3-scroll-depth-tracking:
    path: docs/sprint/sprint-artifacts/5-2-3-scroll-depth-tracking.md
    status: todo
  5-2-4-engagement-idle-tracking:
    path: docs/sprint/sprint-artifacts/5-2-4-engagement-idle-tracking.md
    status: todo
  5-2-5-form-interaction-tracking:
    path: docs/sprint/sprint-artifacts/5-2-5-form-interaction-tracking.md
    status: todo
  5-2-6-integration-and-tests:
    path: docs/sprint/sprint-artifacts/5-2-6-integration-and-tests.md
    status: todo
  5-2-posthog-ci-env-fix:
    status: done
    meta: "Fixed VITE_POSTHOG_API_KEY and VITE_POSTHOG_HOST injection in CI/CD build step."
  epic-5-retrospective: optional

  # --- Cookie Policy Epics (from docs/product/epics/cookie-policy.md) ---
  cp-epic-1: backlog
  cp-1-1-create-cookie-policy-popup: backlog
  cp-1-2-implement-popup-display: backlog
  cp-1-3-implement-popup-dismissal: backlog
  cp-epic-1-retrospective: optional

  # --- Price Transparency Epics (from docs/product/epics/price-transparency.md) ---
  pt-epic-1: backlog
  pt-1-1-data-modeling-product-costs: backlog
  pt-1-2-admin-ui-cost-configuration: backlog
  pt-epic-1-retrospective: optional

  pt-epic-2: backlog
  pt-2-1-infrastructure-cost-fetcher: backlog
  pt-2-2-ad-spend-aggregator: backlog
  pt-2-3-payment-saas-fee-calculator: backlog
  pt-epic-2-retrospective: optional

  pt-epic-3: backlog
  pt-3-1-dynamic-price-calculation-logic: backlog
  pt-3-2-session-based-price-locking: backlog
  pt-epic-3-retrospective: optional

  pt-epic-4: backlog
  pt-4-1-pdp-price-breakdown-component: backlog
  pt-4-2-cost-context-tooltips: backlog
  pt-4-3-social-impact-visualization: backlog
  pt-epic-4-retrospective: optional

  pt-epic-5: backlog
  pt-5-1-charity-api-integration: backlog
  pt-5-2-post-purchase-async-donation: backlog
  pt-5-3-impact-certificate-email: backlog
  pt-epic-5-retrospective: optional

  pt-epic-6: backlog
  pt-6-1-price-monitoring-job: backlog
  pt-6-2-automated-credit-issuance: backlog
  pt-6-3-good-news-notification: backlog
  pt-epic-6-retrospective: optional

  # --- Payment Integration Epics (from docs/product/epics/payment-integration.md) ---
  pi-epic-1: in-progress
  1-1-validate-backend-webhooks:
    path: docs/sprint/sprint-artifacts/1-1-validate-backend-webhooks.md
    status: done
  1-2-validate-storefront-checkout:
    path: docs/sprint/sprint-artifacts/1-2-validate-storefront-checkout.md
    status: done
  1-3-implement-express-checkout-handler:
    path: docs/sprint/sprint-artifacts/1-3-implement-express-checkout-handler.md
    status: done
  1-4-validate-auth-only-logic:
    path: docs/sprint/sprint-artifacts/1-4-validate-auth-only-logic.md
    status: done
  pi-epic-1-retrospective: optional

  pi-epic-2: in-progress
  2-1-implement-redis-token-infra:
    path: docs/sprint/sprint-artifacts/2-1-implement-redis-token-infra.md
    status: done
  2-2-expiration-listener:
    path: docs/sprint/sprint-artifacts/2-2-expiration-listener.md
    status: done
  2-3-capture-workflow:
    path: docs/sprint/sprint-artifacts/2-3-capture-workflow.md
    status: done
  2-4-fallback-cron:
    path: docs/sprint/sprint-artifacts/2-4-fallback-cron.md
    status: done
  pi-epic-2-retrospective: optional

  pi-epic-3: backlog
  3-1-storefront-timer-edit-ui:
    path: docs/sprint/sprint-artifacts/3-1-storefront-timer-edit-ui.md
    status: done
  3-2-increment-authorization-logic:
    path: docs/sprint/sprint-artifacts/3-2-increment-authorization-logic.md
    status: done
    meta: "Contains merged scope from 3-3. 5 review rounds completed."
  3-4-order-cancellation-during-grace-period:
    path: docs/sprint/sprint-artifacts/3-4-order-cancellation-during-grace-period.md
    status: done
  pi-epic-3-retrospective: optional

  pi-epic-4: backlog
  4-1-magic-link-generation:
    path: docs/sprint/sprint-artifacts/4-1-magic-link-generation.md
    status: done
  4-2-guest-auth-middleware:
    path: docs/sprint/sprint-artifacts/4-2-guest-auth-middleware.md
    status: done
  4-3-session-persistence:
    path: docs/sprint/sprint-artifacts/4-3-session-persistence.md
    status: done
  pi-epic-4-retrospective: optional

  pi-epic-5: in-progress
  5-1-e2e-grace-period-tests:
    path: docs/sprint/sprint-artifacts/5-1-e2e-grace-period-tests.md
    status: done
  5-2-e2e-test-infrastructure:
    status: backlog
    meta: "Enable E2E tests in CI - remove test.skip(), add order seeding, overhaul existing tests for recent changes"
  pi-epic-5-retrospective: optional

  pi-epic-6: in-progress
  6-1-webhook-validation-retry:
    path: docs/sprint/sprint-artifacts/6-1-webhook-validation-retry.md
    status: done
  6-2-redis-connection-failure-handling:
    path: docs/sprint/sprint-artifacts/6-2-redis-connection-failure-handling.md
    status: done
  6-3-race-condition-handling:
    path: docs/sprint/sprint-artifacts/6-3-race-condition-handling.md
    status: done
  6-4-increment-fallback-flow:
    path: docs/sprint/sprint-artifacts/6-4-increment-fallback-flow.md
    status: done
  pi-epic-6-retrospective: optional

  pi-epic-7: backlog
  7-1-secure-token-generation: backlog
  7-2-rate-limiting: backlog
  7-3-audit-logging: backlog
  7-4-csrf-protection: backlog
  pi-epic-7-retrospective: optional

  pi-epic-8: in-progress
  8-1-structured-logging:
    status: done
    path: docs/sprint/sprint-artifacts/checkout-payment-flow-fixes.md
    meta: "Implemented as part of checkout-payment-flow-fixes story. PR #55 merged 2025-12-13."
  8-2-metrics-dashboard: backlog
  8-3-alerting: backlog
  pi-epic-8-retrospective: optional

  # Backlog: Atomic batch item addition
  batch-add-items-endpoint:
    status: backlog
    meta: "Create POST /store/orders/:id/line-items/batch for atomic multi-item add. Single Stripe increment call for total, all-or-nothing commit. Required for true AC6 compliance with multi-item UX."

  # --- Course Correction: Checkout Payment Flow Fixes (2025-12-12) ---
  checkout-payment-flow-fixes:
    status: done
    proposal: docs/sprint/proposals/sprint-change-proposal-2025-12-12-checkout-fixes.md
    story: docs/sprint/sprint-artifacts/checkout-payment-flow-fixes.md
    meta: "PR #55 merged 2025-12-13. PaymentIntent lifecycle, idempotency, structured logging."
    completed: "2025-12-13"
    changes:
      - id: change-1-payment-intent-lifecycle
        status: done
        files:
          [
            "apps/storefront/app/routes/api.payment-intent.ts",
            "apps/storefront/app/routes/checkout.tsx",
          ]
        description: "Create once, update on changes pattern with server-side idempotency"
      - id: change-2-structured-logging
        status: done
        files: ["apps/storefront/app/lib/logger.ts"]
        description: "New logger utility with trace ID generation and propagation"
      - id: change-3-backend-idempotency
        status: done
        files: ["apps/backend/src/loaders/stripe-event-worker.ts"]
        description: "Idempotent order creation in webhook handler"

  # --- Transactional Email Integration (from docs/product/epics/transactional-email-epics.md) ---
  # Added: 2025-12-14
  # Updated: 2025-12-15
  # PRD: docs/product/prds/transactional-email-prd.md
  # Architecture: docs/product/architecture/transactional-email-architecture.md
  #
  # ARCHITECTURAL DECISION (2025-12-15): BullMQ queue is REQUIRED per architecture.
  # Existing Medusa Workflow implementation must be REPLACED with BullMQ.
  # See: docs/sprint/agent-prompt-transactional-email.md for migration details.

  email-epic-1: in-progress
  email-1-1-create-email-queue-service:
    path: docs/sprint/sprint-artifacts/email-1-1-create-email-queue-service.md
    status: done
    meta: "Create BullMQ queue singleton + enqueueEmail() function"
  email-1-2-create-email-worker:
    path: docs/sprint/sprint-artifacts/email-1-2-create-email-worker.md
    status: done
    meta: "Create BullMQ worker that processes email jobs via Resend"
  email-1-3-verify-non-blocking-behavior:
    path: docs/sprint/sprint-artifacts/email-1-3-verify-non-blocking-behavior.md
    status: done
    meta: "Ensure email failures never block order flows"
  email-epic-1-retrospective: optional

  email-epic-2: ready-for-dev
  email-2-1-implement-exponential-backoff-retry:
    path: docs/sprint/sprint-artifacts/email-2-1-implement-exponential-backoff-retry.md
    status: done
    meta: "3x retry with 1s, 2s, 4s exponential backoff delays"
  email-2-2-implement-dead-letter-queue:
    path: docs/sprint/sprint-artifacts/email-2-2-implement-dead-letter-queue.md
    status: done
    meta: "Redis list email:dlq for failed emails after all retries"
  email-2-3-handle-invalid-email-addresses:
    path: docs/sprint/sprint-artifacts/email-2-3-handle-invalid-email-addresses.md
    status: done
    meta: "Skip retry for invalid emails, go directly to DLQ"
  email-epic-2-retrospective: optional

  email-epic-3: ready-for-dev
  email-3-1-wire-order-placed-subscriber:
    path: docs/sprint/sprint-artifacts/email-3-1-wire-order-placed-subscriber.md
    status: done
    meta: "REFACTOR REQUIRED - Replace sendOrderConfirmationWorkflow with enqueueEmail()"
    migration_note: "Existing workflow implementation must be replaced with BullMQ queue call"
  email-3-2-generate-magic-link-for-guests:
    path: docs/sprint/sprint-artifacts/email-3-2-generate-magic-link-for-guests.md
    status: done
    meta: "Integrated magic link generation with BullMQ queue - Refactor complete"
    migration_note: "ModificationTokenService integrated with new queue approach"
  email-3-3-update-order-confirmation-template:
    path: docs/sprint/sprint-artifacts/email-3-3-update-order-confirmation-template.md
    status: done
    meta: "Review Complete: Added missing unit tests, fixed AC (registered user message), updated text to match AC."
    completed: "2025-12-15"
  email-3-4-e2e-order-confirmation-flow:
    path: docs/sprint/sprint-artifacts/email-3-4-e2e-order-confirmation-flow.md
    status: done
    meta: "Code Review: Comprehensive test coverage already exists across 7 test files covering all ACs"
    completed: "2025-12-15"
  email-epic-3-retrospective: optional

  email-epic-4: ready-for-dev
  email-4-1-create-pii-masking-utility:
    path: docs/sprint/sprint-artifacts/email-4-1-create-pii-masking-utility.md
    status: done
    meta: "Code Review: Implementation and tests verified complete (9 tests passing)"
    completed: "2025-12-16"
  email-4-2-add-structured-logging:
    path: docs/sprint/sprint-artifacts/email-4-2-add-structured-logging.md
    status: done
    meta: "Code Review: All 5 ACs verified - [EMAIL][QUEUE/PROCESS/SENT/FAILED/DLQ] logs with [METRIC]"
    completed: "2025-12-16"
  email-4-3-add-failure-alerting:
    path: docs/sprint/sprint-artifacts/email-4-3-add-failure-alerting.md
    status: done
    meta: "Code Review: All 4 ACs verified - [EMAIL][ALERT] with parseable key=value format"
    completed: "2025-12-16"
  email-epic-4-retrospective: optional

  # --- Checkout Audit Fixes (from docs/analysis/checkout-flow-issues-audit.md) ---
  audit-epic-1: in-progress
  fix-SEC-01-client-trust-pricing:
    path: docs/sprint/sprint-artifacts/fix-SEC-01-client-trust-pricing.md
    status: done
  fix-SEC-02-unsafe-order-endpoint:
    path: docs/sprint/sprint-artifacts/fix-SEC-02-unsafe-order-endpoint.md
    status: done
    meta: "Emergency security fix complete. Stripped PII, removed token minting, added security headers, input validation, audit logging. Query optimized to 24h window. 16 unit tests pass. PR review comments addressed."
    completed: "2025-12-30"
  fix-SEC-03-token-expiry-anchoring:
    path: docs/sprint/sprint-artifacts/fix-SEC-03-token-expiry-anchoring.md
    status: drafted
  fix-SEC-04-client-secret-leak:
    path: docs/sprint/sprint-artifacts/fix-SEC-04-client-secret-leak.md
    status: drafted
  fix-SEC-05-localstorage-token:
    path: docs/sprint/sprint-artifacts/fix-SEC-05-localstorage-token.md
    status: drafted
  fix-ORD-01-add-items-workflow:
    path: docs/sprint/sprint-artifacts/fix-ORD-01-add-items-workflow.md
    status: drafted
  fix-ORD-02-post-auth-amount:
    path: docs/sprint/sprint-artifacts/fix-ORD-02-post-auth-amount.md
    status: drafted
  fix-ORD-03-address-update-token:
    path: docs/sprint/sprint-artifacts/fix-ORD-03-address-update-token.md
    status: drafted
  fix-PAY-01-payment-status-model:
    path: docs/sprint/sprint-artifacts/fix-PAY-01-payment-status-model.md
    status: done
    meta: "Code review complete 2025-12-30. All ACs implemented. PaymentCollection creation, capture via Payment Module, OrderTransaction records, canonical payment status API. Currency units verified via official docs. NO backward compatibility - fails loudly if PaymentCollection missing."
    completed: "2025-12-30"
    depends_on: []
    blocks: ["RET-01", "TAX-01"]
  fix-CHK-01-canonical-checkout:
    path: docs/sprint/sprint-artifacts/fix-CHK-01-canonical-checkout.md
    status: done
  fix-SHP-01-shipping-option-persistence:
    path: docs/sprint/sprint-artifacts/fix-SHP-01-shipping-option-persistence.md
    status: drafted
  fix-TAX-01-end-to-end-tax:
    path: docs/sprint/sprint-artifacts/fix-TAX-01-end-to-end-tax.md
    status: done
    meta: "Tax calculation implemented in add-item-to-order workflow. Uses Medusa's calculated_price.tax_total, tracks per-item tax in metadata (tax_amount), stores accumulated tax in metadata.updated_tax_total. 7 new unit tests passing (28 total). Medusa v2 computed field architecture respected."
    completed: "2025-12-30"
    depends_on: ["SEC-01"]
  fix-RET-01-returns-refunds:
    path: docs/sprint/sprint-artifacts/fix-RET-01-returns-refunds.md
    status: done
    meta: "Implemented charge.refunded webhook handler with PaymentCollection updates, OrderTransaction creation, and order status updates. Supports both full and partial refunds. 13 unit tests passing (100% pass)."
    completed: "2025-12-30"
    depends_on: ["PAY-01"]
  fix-MNY-01-money-units:
    path: docs/sprint/sprint-artifacts/fix-MNY-01-money-units.md
    status: done
  fix-INV-01-inventory-decrement:
    path: docs/sprint/sprint-artifacts/fix-INV-01-inventory-decrement.md
    status: drafted
  fix-REL-01-idempotency-key:
    path: docs/sprint/sprint-artifacts/fix-REL-01-idempotency-key.md
    status: done
    meta: "Removed Math.random() from idempotency key - now deterministic hash(cartId + amount + currency)"
    completed: "2025-12-29"
  fix-PERF-01-stock-validation:
    path: docs/sprint/sprint-artifacts/fix-PERF-01-stock-validation.md
    status: drafted
  fix-CONC-01-edit-status-locking:
    path: docs/sprint/sprint-artifacts/fix-CONC-01-edit-status-locking.md
    status: drafted
  fix-UX-01-cart-update-quantity:
    path: docs/sprint/sprint-artifacts/fix-UX-01-cart-update-quantity.md
    status: drafted
  fix-FUL-01-fulfillment-tracking:
    path: docs/sprint/sprint-artifacts/fix-FUL-01-fulfillment-tracking.md
    status: drafted
  audit-epic-1-retrospective: optional
